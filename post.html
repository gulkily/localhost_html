<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="alternate" title="RSS Feed" href="/rss.xml" type="application/rss+xml"></link>
<title>post</title>
<style type="text/css">
<!--
/* begin css/default.css */
.tag-flag,
.tag-troll,
.tag-spam,
.tag-remove,
.tag-slash,
.tag-abuse {
/* negative (red) tags */
	color: #aa4040;
	font-weight: bold;
}

.tag-remove {
/* remove tag */
	font-weight: bold;
}

.tag-approve,
.tag-accept,
.tag-friend,
.tag-attend,
.tag-like,
.tag-vouch {
/* positive (green) tags */
	color: #60c060;
	font-weight: bold;
}

.tag-hide {
	color: gray;
}

div.reply {
/* creates indented effect for sub-replies */
	margin-left: 2%;
	padding-left: 3em;
}

.item-textart {
/* textart items get monospace font */
	font-family: monospace;
	font-size: 12pt;
}

.tag-aolart {
/* aol art in 10-point arial font */
    font-family: Arial;
    font-size: 10pt;
}

div.txt {
	padding-left: 1em;
}

.byadmin {
/* text by admin, displayed in red for users' sake */
	color: red;
}

.signed {
/* signed things are displayed in gold */
    border-color: gold;
}


#eventLocation {
/* event form */
	background-color: #202020;
	padding: 5pt;
}

#eventDate {
/* event form */
	background-color: #282828;
	padding: 5pt;
}

#loadingIndicator, #spanLoadingIndicator, #ariaAlert {
	color: #aaaaaa;
	background-color: #484830;
	padding: 3pt;
	position: fixed;
	top: 0;
	left: 0;
	margin: 0;
	font-family: tahoma, arial, sans-serif;
	font-weight: bold;
}
#loadingIndicator a {
	/* style for links in loading indicator */
}
.notification {
	color: #aaaaaa;
	background-color: #484830;
	padding: 3pt;
	font-weight: bold;
	padding: 3pt;
}
noscript, .noscript {
	color: red;
}
.menubar a, .titlebar a, .topmenubar a {
	text-decoration: none;
	color: #aaaaaa;
}
nobr {
	white-space:nowrap;
}
input[type=button], button, input[type=submit] {
	color: #aaaaaa;
	background-color: #202020
}
/* end css/default.css */

/* dragging.css */

/* should be called inline-block.css ? */

/* makes some dialogs horizontal */
table.dialog { /* inline-table table-block */
	display: inline-block;
	vertical-align: top;
}
form {
	display: inline;
}

/*
#topmenu.dialog {
	position: fixed !important;
	top: 0;
	right: 0;
}
*/

/* / dragging.css */

.dialog .txt {
	max-width: 30em;
}

/* inbox_top.css */

#messages {
	position: absolute !important;
	top: 0 !important;
	right: 0 !important;
	margin-top: 5pt !important;
}

/* / inbox_top.css */

/* theme/dark/additional.css */
body {
	font-family: helvetica;
	font-size: 14pt;
	background-color: #222222;
}
fieldset {
	border-color: #666666;
}
.dialog {
	border-radius: 5pt;
	background-color: #202020;
	font-family: tahoma, helvetica, arial, sans-serif;
	font-size: 10pt;
	box-shadow: 0 0 15pt #335555;
	margin-bottom: 5pt;
}
button, input[type=button], input[type=submit], input[type=checkbox] {
	background-color: #202020;
	color: #aaaaaa;
	border-color: #555555;
	box-shadow: 0 0 5pt #335555;
}
input[type=text], input[type=password], select, option, textarea {
	background-color: #222222;
	color: #c0c0c0;
	border-color: #555555;
}
#txtClock {
	border: 0;
	color: #8080c0;
}
.statusbar td {
	border: 1pt inset #202020;
}
textarea {
    font-family: serif;
    font-size: 12pt;
}
fieldset {
    border-radius: 3pt;
}
.titlebar, .titlebar td {
    border-radius: 3pt;
}
*:focus, *:active {
/* focused items are orange for visibility */
    background-color: #402010 !important;
    color: orange !important;
}
#serverResponse {
/* response from server */
    background-color: #402820;
    color: #aaaaaa;
    padding: 5pt;
    spacing: 5pt;
    border: 2pt #202030 double;
    display: block
}
@media only screen and (min-width : 40em) {
	.item-textart {
		max-width: 90%;
		background-color: #808080;
	}
	.dialog .txt {
		max-width: 40em;
	}
}
.fileHashShort {
	text-decoration: underline dotted;
}
.titlebarButtons {
	float: right;
}
button.close, button.skip {
	border: 0;
	margin: 0;
}
/* / theme/dark/additional.css */
/* pre_time_sans.css */

pre time {
	font-family: helvetica, arial, sans-serif;
}

/* /pre_time_sans.css */

-->
</style>
</head>
<body link="#8888cc" vlink="#cc88cc" text="#aaaaaa" bgcolor="#404040" onload="makeRefLink();">
<b>
<!-- template/topmenu2.template -->
<table cellspacing=0 cellpadding=3 border=0 bgcolor="#202020" class=dialog id=topmenu>
	<tr bgcolor="#202020" class=topmenubar>
		<td colspan=2>
			<big>
				<big>
<!-- menuitem.template -->
<a accesskey=w href="/welcome.html"><u>W</u>elcome</a>
<!-- / menuitem.template -->
;


<!-- menuitem.template -->
<a accesskey=t href="/threads.html"><u>T</u>hreads</a>
<!-- / menuitem.template -->
;


<!-- menuitem.template -->
<a accesskey=u href="/upload.html"><u>U</u>pload</a>
<!-- / menuitem.template -->
;


<!-- menuitem.template -->
<a accesskey=i href="/write.html">Wr<u>i</u>te</a>
<!-- / menuitem.template -->
;


<!-- menuitem.template -->
<a accesskey=s href="/settings.html"><u>S</u>ettings</a>
<!-- / menuitem.template -->
;


<!-- menuitem.template -->
<a accesskey=p href="/profile.html"><u>P</u>rofile</a>
<!-- / menuitem.template -->
;


<!-- menuitem.template -->
<a accesskey=a href="/authors.html"><u>A</u>uthors(3)</a>
<!-- / menuitem.template -->
;


<!-- menuitem.template -->
<a accesskey=g href="/tags.html">Ta<u>g</u>s(9)</a>
<!-- / menuitem.template -->
;


<!-- menuitem.template -->
<a accesskey=h href="/help.html"><u>H</u>elp</a>
<!-- / menuitem.template -->
</big>
				<span class=advanced></span>
				<span class=admin> </span>
				<span id=controls></span>
				<span id=spnClock></span>
			</big>
		</td>
	</tr>
	<tr bgcolor="#202030" class=titlebar>
		<td>
			<small>
				<font color="#aaaaaa"><b>Welcome</b></font>
			</small>
		</td>
		<td align=right>
			<small>
				<span id=spanDialogControls>
<!-- layer_controls.template -->

<noscript>*</noscript>

<span>
	<a id=btnAdvanced href=#
		accesskey=o
		onclick="
			if (window.SetPrefs) {
				SetPrefs('show_advanced', 1);
				SetPrefs('advanced_highlight', 0);
				SetPrefs('beginner', 0);
				SetPrefs('beginner_highlight', 0);
				SetPrefs('notify_on_change', 1);
			}
			if (window.ShowAdvanced) {
				ShowAdvanced(0, 0);
				return false;
			}
		"
	>Expand</a>;

	<a id=btnMinimal href=#
		accesskey=n
		onclick="
			if (window.SetPrefs) {
				SetPrefs('show_advanced', 0);
				SetPrefs('admin', 0);
			}
			if (window.ShowAdvanced) {
				ShowAdvanced(0, 0);
				return false;
			}
		"
	title=Minimal>Minimal</a>;

	<a id=btnReprint href=# accesskey=r onclick="
		var winLoc = window.location.href;
		if (winLoc.indexOf('?')) {
			winLoc = winLoc.substr(0, winLoc.indexOf('?'));
		}
		var d = new Date();
		var n = d.getTime();
		n = Math.ceil(n / 1000);
		n = n + 86400;
		winLoc = winLoc + '?time=' + n;
		window.location = winLoc;
		return false;
	" title="Reprint">Reprint</a>;

</span>

<!-- / layer_controls.template -->
</span>
			</small>
		</td>
	</tr>
</table>
<!-- / topmenu2.template -->
</b>
<p><MAIN ID=maincontent><A NAME=maincontent></A>


<!-- post.template -->
<font face=arial>
	<table cellspacing=0 cellpadding=6 border=0 bgcolor="#202020" class=dialog>
		<tr bgcolor="#202040" class=titlebar>
			<td>
				<font color="#aaaaaa"><b>Submission Received!</b></font>
			</td>
		</tr>

		<tr class=body>
			<td class=content>
				<p>Thank you!
				<p>Your submission has been received.
				<p>You may not see it appear on the site immediately.
				<p>Once the server has caught up, you should see it on the <br>
				<a href="/new.html">New Items Page.</a>
				<p><b><span id=retRef></span></b>
				<p><span><!-- submitted_text --></span>
				<p><hr>
				<span class=advanced>
					<br>
					<p>Operator: If you see this message, run <br>
					<code>./hike.sh alog</code>
					<br>
					or
					<br>
					<br>
					<code>hike alog</code>
				</span>
			</td>
		</tr>

		<tr class=statusbar>
			<td>
				<p>Ready
			</td>
		</tr>
	</table>
</font>

<!-- / post.template -->
</main>
<span id=messages></span>
<img src="/p.gif" alt="" height=1 width=1>
<br><noscript>
<!-- default/template/html/window/standard.template -->
<font face=arial>
	<table id=Notice cellspacing=0 cellpadding=6 border=0 bgcolor="#202020" class=dialog>
		
<!-- titlebar.template -->
<tr bgcolor="#202040" class=titlebar>
	<td>
		<font color="#aaaaaa"><b>Notice</b></font> <a href=#Notice>#</a><a name=Notice></a><br>
		<!-- note! dragging.js looks for a "b" inside of a class=titlebar -->
	</td>
</tr>
<!-- / titlebar.template -->


		

		

		<tbody class=content><tr class=content><td><b class=noscript>*</b> Some features may require JavaScript</td></tr></tbody>

		
	</table>
</font>
<!-- / default/template/html/window/standard.template -->
</noscript>
<!-- InjectJs: settings avatar post fresh table_sort -->


<!-- html/utils/scriptinject.template -->
<script language=javascript><!--
// == begin settings.js

var showAdvancedLastAction = '';
var showBeginnerLastAction = '';
var showMeaniesLastAction = '';
var showAdminLastAction = '';
var showTimestampsLastAction = '';
var showPageInfoLastAction = '';

var timerShowAdvanced;

function SetElementVisible (element, displayValue, bgColor, borderStyle) { // sets element's visible status based on tag type
// displayValue = 'none' or 'initial'
// 	when 'initial', will try to substitute appropriate default for tag type
// also sets background color
// used for hiding/showing and highlighting beginner, advanced element classes on page.
	if (element) {
		//alert('DEBUG: SetElementVisible: before: ' + element.nodeName + ' : ' + element.style.display);
	} else {
		//alert('DEBUG: SetElementVisible: before: warning: no element');
		return '';
	}

	var changesMade = 0;

	//alert('DEBUG: SetElementVisible:' + element.tagName + "; displayValue:" + displayValue + "; bgColor:" + bgColor + "; borderStyle:" + borderStyle + "\n");

	if (bgColor && (element.tagName != 'SPAN')) {
		// background color
		if (bgColor == 'initial') {
			bgColor = '#202020';
		}

		if (element.style.backgroundColor != bgColor) {
			element.style.backgroundColor = bgColor;
			changesMade++;
		}
		// this may cause issues in some themes
	}

	// depending on element type, we set different display style
	// block, table-row, table-cell, or default of 'initial'
	if (displayValue == 'initial' && (element.nodeName == 'P' || element.nodeName == 'H3' || element.nodeName == 'FIELDSET' || element.nodeName == 'HR')) {
		if (element.style.display != '') {
			element.style.display = '';
			changesMade++;
		}
		// element.style.display = 'block';
	} else if (displayValue == 'initial' && element.nodeName == 'TR') {
		if (element.style.display != '') {
			element.style.display = '';
			changesMade++;
		}
		// element.style.display = 'table-row';
	} else if (displayValue == 'initial' && (element.nodeName == 'TH' || element.nodeName == 'TD' || element.nodeName == 'TBODY')) {
		if (element.innerHTML != '') {
			if (element.style.display != '') {
				element.style.display = '';
				changesMade++
			}
			// element.style.display = 'table-cell';
		} else {
			if (element.style.display != 'none') {
				element.style.display = 'none'; // empty table cells display = none #why?
			}
		}
	} else {
		if (displayValue == 'initial') {
			displayValue = '';
			// displayValue = 'inline';
		}
		if (element.style.display != displayValue) {
			element.style.display = displayValue;
			changesMade++;
		}
		if (borderStyle) {
			// border style
			if (element.style.border != borderStyle) {
				element.style.border = borderStyle;
				changesMade++;
			}
			//element.style.borderRadius = '3pt';
		}
	}

	if (element) {
		//alert('DEBUG: SetElementVisible: after: ' + element.nodeName + ' : ' + element.style.display);
		if (changesMade) {
			return changesMade;
		} else {
			return 0;
		}
	} else {
		//alert('DEBUG: SetElementVisible: after: warning: no element');
		return changesMade;
	}

	return changesMade;
} // SetElementVisible()

function ShowAll (t, container) { // t = clicked link ; container = document by default ; shows all elements, overriding settings
// admin elements are excluded. only beginner, advanced class elements are shown
	if (!document.getElementsByClassName) {
		//alert('DEBUG: ShowAll: warning: getElementsByClassName feature check FAILED');
		return false;
	}

	var gt = unescape('%3E');

	if (!container) {
		container = document;
	}

	var isMore = 1; // if 0, it is 'Less' link

	// change link caption, there are different variations
	if (t.innerHTML == 'Less') {
		// when without accesskey
		t.innerHTML = 'More';
		isMore = 0;
	}
	if (t.innerHTML == 'Less (<u' + gt + 'O</u' + gt + ')') {
		// when with accesskey
		t.innerHTML = 'M<u' + gt + 'o</u' + gt + 're';
		isMore = 0;
	}
	if (t.innerHTML == '<u' + gt + 'O</u' + gt + '') {
		// just the letter with accesskey
		t.innerHTML = '<u' + gt + 'o</u' + gt + '';
		isMore = 0;
	}

	if (isMore && container.getElementsByClassName) {
		// change link caption, there are different variations
		if (t.innerHTML == 'More') {
			// without accesskey
			t.innerHTML = 'Less';
		}
		if (t.innerHTML == 'M<u' + gt + 'o</u' + gt + 're') {
			// with accesskey
			t.innerHTML = 'Less (<u' + gt + 'O</u' + gt + ')';
		}
		if (t.innerHTML == '<u' + gt + 'o</u' + gt + '') {
			// just the letter with accesskey
			t.innerHTML = '<u' + gt + 'O</u' + gt + '';
		}

		var display;
		display = 'initial';

		var elements = container.getElementsByClassName('advanced');
		for (var i = 0; i < elements.length; i++) {
			SetElementVisible(elements[i], display, '#504040', 0);
		}

		if (0) { // #todo
			var elements = container.getElementsByClassName('heading');
			for (var i = 0; i < elements.length; i++) {
				SetElementVisible(elements[i], display, '#504040', 0);
			}
			var elements = container.getElementsByClassName('menubar');
			for (var i = 0; i < elements.length; i++) {
				SetElementVisible(elements[i], display, '#504040', 0);
			}
			//var elements = container.getElementsByClassName('statusbar');
			//for (var i = 0; i < elements.length; i++) {
			//    SetElementVisible(elements[i], display, '#504040', 0);
			//}
		}
		elements = container.getElementsByClassName('beginner');
		for (var i = 0; i < elements.length; i++) {
			SetElementVisible(elements[i], display, '#484830', 0);
		}
		elements = container.getElementsByClassName('expand');
		for (var i = 0; i < elements.length; i++) {
			SetElementVisible(elements[i], 'none', '', 0);
		}

		if (timerShowAdvanced) {
			clearTimeout(timerShowAdvanced);
		}
		//timerShowAdvanced = setTimeout('ShowAdvanced(1);', 10000);
		//
		//if (t && t.getAttribute('onclick')) {
		//t.setAttribute('onclick', '');
		//}
		//if (window.ArrangeAll) {
		//	ArrangeAll();
		//}

		return false;
	} else {
		ShowAdvanced(1, 0);

		return false;
	}

	return true;
} // ShowAll()

function ShowAdvanced (force, container) { // show or hide controls based on preferences
//handles class=advanced based on 'show_advanced' preference
//handles class=beginner based on 'beginner' preference
//force parameter
// 1 = does not re-do setTimeout (called this way from checkboxes)
// 0 = previous preference values are remembered, and are not re-done (called by timer)

	//alert('DEBUG: ShowAdvanced(' + force + ')');

	if (!container) {
		container = document;
		// allows for localized effects (not document-wide)
		// this feature may or may not be actually used or tested
	}

	var counterChangesMade = 0;

	if (document.getElementById && window.localStorage && container.getElementsByClassName) {
		//alert('DEBUG: ShowAdvanced: feature check passed!');
		///////////

		var styleAssistShowAdvanced = document.getElementById('styleAssistShowAdvanced');
		if (styleAssistShowAdvanced && styleAssistShowAdvanced.remove) {
			styleAssistShowAdvanced.remove();
		}
		// this hides the special stylesheet which we inject into the page
		// so that there is no jittery dialog repositioning

		var displayTimestamps = '0';
		if (GetPrefs('timestamps_format')) {
			displayTimestamps = 1;
		}
		if (force || window.showTimestampsLastAction != displayTimestamps) {
			//ShowTimestamps();
			window.showTimestampsLastAction = displayTimestamps;
			counterChangesMade++;
		}

		{ // #show_admin
			var displayAdmin = 'none'; // not voting by default
			if (GetPrefs('show_admin') == 1) { // check value of show_admin preference
				displayAdmin = 'initial'; // display
			}
			if (force || showAdminLastAction != displayAdmin) {
				var elemAdmin = container.getElementsByClassName('admin');

				for (var i = 0; i < elemAdmin.length; i++) {
					SetElementVisible(elemAdmin[i], displayAdmin, 0, 0);
				}

				//// #todo make this optional
				//var elemAdmin = container.getElementsByClassName('heading');
				//
				//for (var i = 0; i < elemAdmin.length; i++) {
				//	SetElementVisible(elemAdmin[i], displayAdmin, 0, 0);
				//}
				//
				//var elemAdmin = container.getElementsByClassName('statusbar');
				//
				//for (var i = 0; i < elemAdmin.length; i++) {
				//	SetElementVisible(elemAdmin[i], displayAdmin, 0, 0);
				//}

				counterChangesMade++;
			}
		}

		{ // #show_advanced
			var displayValue = 'none'; // hide by default
			if (GetPrefs('show_advanced') == 1) { // check value of show_advanced preference
				displayValue = 'initial'; // display
			}

			var bgColor = 'initial';
			if (GetPrefs('advanced_highlight') == 1) { // check value of advanced_highlight preference
				bgColor = '#504040'; // advanced_highlight
			}

			if (force || showAdvancedLastAction != (displayValue + bgColor)) {
				// thank you stackoverflow
				var divsToHide = container.getElementsByClassName("advanced"); //divsToHide is an array #todo nn3 compat
				for (var i = 0; i < divsToHide.length; i++) {
					//divsToHide[i].style.visibility = "hidden"; // or
					SetElementVisible(divsToHide[i], displayValue, bgColor, 0);
				}

				if (0) { // #todo
					var divsToHide = container.getElementsByClassName("heading"); //divsToHide is an array #todo nn3 compat
					for (var i = 0; i < divsToHide.length; i++) {
						//divsToHide[i].style.visibility = "hidden"; // or
						SetElementVisible(divsToHide[i], displayValue, bgColor, 0);
					}
					var divsToHide = container.getElementsByClassName("menubar"); //divsToHide is an array #todo nn3 compat
					for (var i = 0; i < divsToHide.length; i++) {
						//divsToHide[i].style.visibility = "hidden"; // or
						SetElementVisible(divsToHide[i], displayValue, bgColor, 0);
					}
		//			var divsToHide = container.getElementsByClassName("statusbar"); //divsToHide is an array #todo nn3 compat
		//			for (var i = 0; i < divsToHide.length; i++) {
		//				//divsToHide[i].style.visibility = "hidden"; // or
		//				SetElementVisible(divsToHide[i], displayValue, bgColor, 0);
		//			}
				}
	//			var clock = document.getElementById('txtClock');
	//			if (clock) {
	//			    SetElementVisible(clock, displayValue, bgColor, 0);
	//			}
				showAdvancedLastAction = displayValue + bgColor;

				counterChangesMade++;
			}
		} // show_advanced

		{ // #beginner_highlight
			displayValue = 'initial'; // show by default
			if (GetPrefs('beginner') == 0) { // check value of beginner preference
				displayValue = 'none';
			}

			bgColor = 'initial';
			if (GetPrefs('beginner_highlight') == 1) { // check value of beginner preference
				bgColor = '#484830'; // beginner_highlight
			}

			if (force || showBeginnerLastAction != displayValue + bgColor) {
				var divsToShow = container.getElementsByClassName('beginner');//#todo nn3 compat

				for (var i = 0; i < divsToShow.length; i++) {
					SetElementVisible(divsToShow[i], displayValue, bgColor, 0);
				}
				showBeginnerLastAction = displayValue + bgColor;

				counterChangesMade++;
			}
		}
//
//		if (window.freshTimeoutId) {
//			// reset the page change notifier state
//			clearTimeout(window.freshTimeoutId);
//
//			if (GetPrefs('notify_on_change')) {
//				// check if page has changed, notify user if so
//				if (window.EventLoop) {
//					EventLoop();
//				}
//			}
//		}

		if (window.setAva) {
			setAva(); // #todo caching similar to above
		}

		//if (!force) {
			//if (timerShowAdvanced) {
			//	clearTimeout(timerShowAdvanced);
			//}
			//timerShowAdvanced = setTimeout('ShowAdvanced()', 3000);
		//}

		//SettingsOnload();

	} else {
		//alert('DEBUG: ShowAdvanced: feature check FAILED!');
		//alert('DEBUG: window.localStorage: ' + window.localStorage + '; document.getElementsByClassName: ' + document.getElementsByClassName);
	}

	if (counterChangesMade) {
		LoadCheckboxValues();
	}

	//alert('DEBUG: ShowAdvanced: returning false');
	return '';
} // ShowAdvanced()

function GetPrefs (prefKey, storeName) { // get prefs value from localstorage
	// function GetConfig {
	// function  GetSetting {

	if (!storeName) {
		storeName = 'settings';
	}

	if (!prefKey) {
		//alert('DEBUG: GetPrefs: warning: missing prefKey');
		return '';
	}

	//alert('DEBUG: GetPrefs(' + prefKey + ')');
	if (window.localStorage) {
		//var nameContainer = 'settings';
		var nameContainer = storeName;

		{ // settings beginning with gtgt go into separate container
			var gt = unescape('%3E');
			if (prefKey.substr(0, 2) == gt+gt) {
				nameContainer = 'voted';
			}
		}
		var currentPrefs = localStorage.getItem(nameContainer);

		var prefsObj;
		if (currentPrefs) {
			prefsObj = JSON.parse(currentPrefs);
		} else {
			prefsObj = Object();
		}
		var prefValue = prefsObj[prefKey];

		if (!prefValue && prefValue != 0 && prefValue != '') {
			if (
				prefKey == 'beginner' || // default
				prefKey == 'beginner_highlight' || // default
				prefKey == 'notify_on_change' // // default
			) {
				// these settings default to 1/true:
				prefValue = 1;
			}
			if (
				prefKey == 'show_advanced' || // default
				prefKey == 'show_admin' || // default
				prefKey == 'draggable' || // default
				prefKey == 'draggable_scale' // default
			) {
				// these settings default to 0/false:
				// #todo does this need to be pre-set, if it is 0?
				// seems to work ok if it is not
				prefValue = 0;
			}

			if (prefKey == 'timestamps_format') {
				// default to 'adjusted' timestamp format
				prefValue = 'adjusted';
			}

			if (prefKey == 'performance_optimization') {
				// default to 'adjusted' timestamp format
				prefValue = 'faster';
			}

			SetPrefs(prefKey, prefValue);
		}

		return prefValue;
	}

	//alert('DEBUG: GetPrefs: fallthrough, returning ');
	return '';
} // GetPrefs()

function SetPrefs (prefKey, prefValue, storeName) { // set prefs key prefKey to value prefValue
	//alert('DEBUG: SetPrefs(' + prefKey + ', ' + prefValue + ')');

	if (!prefKey || !prefKey.substr) {
		//alert('DEBUG: GetPrefs: warning: missing prefKey');
		return '';
	}

	if (!storeName) {
		storeName = 'settings';
	}

	if (prefKey == 'show_advanced' || prefKey == 'beginner' || prefKey == 'show_admin') { // SetPrefs()
		//alert('DEBUG: SetPrefs: setting cookie to match LocalStorage');
		if (window.SetCookie) {
			SetCookie(prefKey, (prefValue ? 1 : 0));
		} else {
			//alert('DEBUG: warning: window.SetCookie missing');
		}
	}

	if (prefKey == 'performance_optimization') {
		window.performanceOptimization = prefValue;
		//alert('DEBUG: SetPrefs: setting cookie to match LocalStorage');
		if (prefValue != 'none') {
			//if (window.EventLoop) {
				// todo enable/disable eventloop?
				// this is disabled because it can cause race condition
				// the race condition manifests itself as checkbox changing state
				//EventLoop();
			//}
		}
	}

	if (window.localStorage) {
		//var nameContainer = 'settings';
		var nameContainer = storeName;

		var gt = unescape('%3E'); // #todo this should be elsewhere
		if (prefKey.substr(0, 2) == gt+gt) {
			nameContainer = 'voted';
		}

		var currentPrefs = localStorage.getItem(nameContainer);
		var prefsObj;
		if (currentPrefs) {
			prefsObj = JSON.parse(currentPrefs);
		} else {
			prefsObj = Object();
		}
		prefsObj[prefKey] = prefValue;

		var newPrefsString = JSON.stringify(prefsObj);
		localStorage.setItem(nameContainer, newPrefsString);

		if (prefKey != 'prefs_timestamp') {
			// remember time preferences were last changed
			var d = new Date();
			var t = d.getTime();
			SetPrefs('prefs_timestamp', t);
		}

		return 0;
	}

	return 1;
} // SetPrefs()

function SaveCheckbox (ths, prefKey) { // saves value of checkbox, toggles affected elements
// id = id of pane to hide or show; not required
// ths = "this" of calling checkbox)
// prefKey = key of preference value to set with checkbox
//
// this function is a bit of a mess, could use a refactor #todo

	//alert('DEBUG: SaveCheckbox(' + ths + ',' + prefKey);

	var checkboxState = (ths.checked ? 1 : 0);
	//alert('DEBUG: checkboxState = ' + checkboxState);

	///////////////////////////////
	// BEFORE SAVE ACTIONS BEGIN //
	//if (prefKey == '' +	'draggable_scale') {
	if (prefKey == '' +	'draggable_scale') {
		if (window.SetActiveDialog) {
			SetActiveDialog(0);
		}
	}
	if (prefKey == 'draggable') {
		if (checkboxState && window.DraggingInit) {
			DraggingInit(0);
		} else {
			if (window.displayNotification) {
				displayNotification('Please reload page');
				// #todo make this nicer
			}
		}
	}
	// BEFORE SAVE ACTIONS FINISH //
	////////////////////////////////


	///////////////////////
	// ACTUAL SAVE BEGIN //
	if (prefKey == 'timestamps_format' || prefKey == 'performance_optimization' && window.ShowTimestamps) { //#todo
		SetPrefs(prefKey, ths.value);
		ShowTimestamps();
	} else {
		// saves checkbox's value as 0/1 value to prefs(prefKey)
		SetPrefs(prefKey, checkboxState);
	}
	// ACTUAL SAVE FINISH //
	////////////////////////

	//////////////////////////////
	// AFTER SAVE ACTIONS BEGIN //
	if (prefKey == 'draggable_scale' || prefKey == 'draggable_activate') {
		if (window.SetActiveDialog) {
			SetActiveDialog(0);
		}
	}

	if (prefKey == 'show_advanced' || prefKey == 'beginner' || prefKey == 'show_admin' && window.ShowAdvanced) { // SaveCheckbox()
		ShowAdvanced(1, 0);
	}

	if (prefKey == 'draggable_restore' && checkboxState) {
		if (document.getElementsByClassName) {
			var dialogs = document.getElementsByClassName('dialog');
			if (dialogs) {
				for (var i = 0; i < dialogs.length; i++) {
					SaveDialogPosition(dialogs[i]);
				}
			}
		}
	}
	// AFTER SAVE ACTIONS FINISH //
	///////////////////////////////

	//alert('DEBUG: after SetPrefs, GetPrefs(' + prefKey + ') returns: ' + GetPrefs(prefKey));

	// call ShowAdvanced(1) to update ui appearance
	// ShowAdvanced(1);

	return 1;
} // SaveCheckbox()

function SetInterfaceMode (ab, thisButton) { // updates several settings to change to "ui mode" (beginner, advanced, etc.)
	//alert('DEBUG: SetInterfaceMode(' + ab + ')');

	if (window.localStorage && window.SetPrefs) {
		if (ab == 'beginner') {
			// switching to beginner mode resets most preferences to their beginner-friendly defaults
			SetPrefs('show_advanced', 0);
			SetPrefs('advanced_highlight', 0);
			SetPrefs('beginner', 1);
			SetPrefs('beginner_highlight', 1);
			SetPrefs('notify_on_change', 1);
			SetPrefs('show_admin', 0);
			SetPrefs('write_enhance', 0);
			SetPrefs('write_autosave', 0);
			SetPrefs('timestamps_format', 'adjusted'); // reset to beginner
			SetPrefs('performance_optimization', 'faster');
			SetPrefs('draggable', 0);
			SetPrefs('draggable_scale', 0);
			SetPrefs('draggable_activate', 0);
			SetPrefs('draggable_restore', 1);
			SetPrefs('draggable_restore_collapsed', 1);
			SetPrefs('draggable_spawn', 0);
			SetPrefs('focus_reply', 0);
			SetPrefs('sign_by_default', 1);

			if (window.DraggingReset) {
				DraggingReset();
			}

			//if (window.displayNotification) {
				//displayNotification('', thisButton);
			//}
		} else if (ab == 'intermediate') {
		if (window.DraggingInit) {
				DraggingInit();
			}
			SetPrefs('show_advanced', 1);
			SetPrefs('advanced_highlight', 1);
			SetPrefs('beginner', 1);
			SetPrefs('beginner_highlight', 1);
			SetPrefs('notify_on_change', 1);
//            SetPrefs('show_admin', 0);
		} else if (ab == 'expert') {
			if (thisButton && window.GetParentDialog) {
				var parentDialog = GetParentDialog(thisButton);
				if (parentDialog) {
					//alert('DEBUG: SetInterfaceMode: calling DraggingInitDialog(parentDialog)');
					DraggingInitDialog(parentDialog);
				}
			}
			SetPrefs('show_advanced', 1);
			SetPrefs('advanced_highlight', 0);
			SetPrefs('beginner', 0);
			SetPrefs('beginner_highlight', 0);
			SetPrefs('notify_on_change', 1);
		}

		ShowTimestamps();
		ShowAdvanced(1, 0);
		LoadCheckboxValues();

		//alert('DEBUG: window.SetPrefs was found, and ShowAdvanced(1) was called');

		return false;
	}

	//alert('DEBUG: returning true');

	return true;
} // SetInterfaceMode()

function LoadCheckbox (c, prefKey) { // updates checkbox state to reflect settings
// function RestoreCheckbox () {
// c = checkbox object
// prefKey = key of preference value
	//console.log(prefKey);
	if (!c) {
		//alert('DEBUG: LoadCheckbox: warning: c was missing');
		// this happens a lot because LoadCheckboxes doesn't verify that elements exist before calling #todo
		// #todo this should really find the checkbox automatically and have only one argument
		//return '';
	}

	//alert('DEBUG: LoadCheckbox(..., ' + prefKey + ')');

	if (prefKey == 'timestamps_format') {
		//alert('DEBUG: LoadCheckbox: timestamps_format');
		var checkboxState = GetPrefs(prefKey);

		if (document.frmSettings && document.frmSettings.optTimestampsFormat) {
			document.frmSettings.optTimestampsFormat.value = checkboxState;
		}
	}
	else if (prefKey == 'performance_optimization') {
		//alert('DEBUG: LoadCheckbox: performance_optimization');
		var checkboxState = GetPrefs(prefKey);

		if (document.frmSettings && document.frmSettings.optPerformanceOptimization) {
			document.frmSettings.optPerformanceOptimization.value = checkboxState;
		}
	}
	else {
		//alert('DEBUG: LoadCheckbox: ' + prefKey);
		var checkboxState = GetPrefs(prefKey);

		if (c && c.checked != (checkboxState ? 1 : 0)) {
			c.checked = (checkboxState ? 1 : 0);
		}

		return 1;
	}

	return 1;
} // LoadCheckbox()

function LoadCheckboxValues () {
	//alert('DEBUG: LoadCheckboxValues()');

	// #todo check if being called too often?

	LoadCheckbox(document.getElementById('chkDraggable'), 'draggable');
	LoadCheckbox(document.getElementById('chkDraggableRestore'), 'draggable_restore');
	LoadCheckbox(document.getElementById('chkDraggableRestoreCollapsed'), 'draggable_restore_collapsed');
	LoadCheckbox(document.getElementById('chkDraggableScale'), 'draggable_scale');
	LoadCheckbox(document.getElementById('chkDraggableActivate'), 'draggable_activate');

	LoadCheckbox(document.getElementById('chkDraggableSpawn'), 'draggable_spawn');
	LoadCheckbox(document.getElementById('chkDraggableSpawnFocus'), 'draggable_spawn_focus');
	LoadCheckbox(document.getElementById('chkShowAdmin'), 'show_admin');
	LoadCheckbox(document.getElementById('chkShowBeginner'), 'beginner');
	LoadCheckbox(document.getElementById('chkShowAdvanced'), 'show_advanced');
	LoadCheckbox(document.getElementById('chkWriteEnhance'), 'write_enhance');
	LoadCheckbox(document.getElementById('chkWriteAutoSave'), 'write_autosave');
	LoadCheckbox(document.getElementById('chkFocusReply'), 'focus_reply');
	LoadCheckbox(document.getElementById('chkSignByDefault'), 'sign_by_default');
	LoadCheckbox(document.getElementById('chkUncheckSignWhenPasting'), 'uncheck_sign_when_pasting');

	//alert('DEBUG: LoadCheckboxValues: about to do option groups');

	LoadCheckbox(document.getElementById('optTimestampsFormat'), 'timestamps_format');
	LoadCheckbox(document.getElementById('optPerformanceOptimization'), 'performance_optimization');
	//LoadCheckbox(document.getElementById('chkExpertTimestamps'), 'expert_timestamps');

} // LoadCheckboxValues()

function SettingsOnload () { // onload function for settings page
	//alert('debug: SettingsOnload() begin');

	if (document.getElementById) {
	// below is code which sets the checked state of settings checkboxes
	// based on settings state
		//var pane;

		LoadCheckboxValues();

		//if (GetPrefs('sign_by_default') == 1) {
		//	var cbM = document.getElementById('chkSignByDefault');
		//	if (cbM) {
		//		cbM.checked = 1;
		//	}
		//}

	}

	//alert('debug: SettingsOnload: returning false');
	return false;
} // SettingsOnload()

if (window.EventLoop) {
	window.eventLoopShowAdvanced = 1;
} else {
	ShowAdvanced(0, 0);
}

// == end settings.js


// == begin avatar.js

var configJsOpenPgp = 1; // this is templated from config/setting/admin/js/openpgp

function setAva () { // sets avatar widgets (and italicizes Profile link)
	//alert('DEBUG: setAva() begins');

	if (document.getElementById && String.fromCharCode) {
		var myidBox = document.getElementById('myid'); // displays username (if preference is set)
		var signinBox = document.getElementById('signin'); // Profile link

		//var gt = String.fromCharCode(62);
		var gt = unescape('%3E');

		if (myidBox && signinBox && window.localStorage) { // check for elements and features
			var myAvatar = localStorage.getItem('avatar');

			// #todo add provision for cookie auth here too

			if (!myAvatar) { // less error prone than checking for == null, i think
				// no avatar, probably not signed in
				signinBox.innerHTML = '<a href="/profile.html"' + gt + 'Register</a' + gt + '';
			} else {
				// there's an avatar, probably signed in
				signinBox.innerHTML = '';
				var myFp = localStorage.getItem('fingerprint');

				if (window.location.pathname == '/author/' + myFp + '/' || window.location.pathname == '/author/' + myFp + '/index.html') {
					var itsYou = document.getElementById('itsyou');
					itsYou.innerHTML = 'This is your profile!';
				}

				if (window.GetPrefs) {
					if (GetPrefs('display_username')) {
						myidBox.innerHTML = '<a href="/profile.html" class=avatar' + gt + myAvatar + '</a' + gt;
						signinBox.innerHTML = '';
					} else {
						myidBox.innerHTML = '';
						signinBox.innerHTML = '<a href="/profile.html"' + gt + '<i' + gt + 'Change</i' + gt + '</a' + gt + '';
					}
				} else {
					myidBox.innerHTML = '';
					signinBox.innerHTML = '<a href="/profile.html"' + gt + '<i' + gt + 'Change</i' + gt + '</a' + gt + '';
				}

				var configJsOpenPgp = 1; // this is templated from config/setting/admin/js/openpgp

				if (configJsOpenPgp && !window.openpgp && document.head && document.getElementById && window.localStorage) {
					//alert('DEBUG: setAva: loading openpgp.js');
					window.openPgpJsLoadBegin = 1;

					var script = document.createElement('script');
					script.src = '/openpgp.js';
					script.async = false; // This is required for synchronous execution
					document.head.appendChild(script);
				}

				if (!window.setAvatar && document.head && document.head.appendChild && document.getElementById && window.localStorage) {
					//alert('DEBUG: setAva: loading crypto2.js');

					var script2 = document.createElement('script');
					script2.src = '/crypto2.js';
					script2.async = false; // This is required for synchronous execution
					document.head.appendChild(script2);
				}
			}
		}
	}

	return true;
} // setAva()
if (window.localStorage && document.getElementById) {
	setAva();
}

function getAvatar () { // retrieve previously built avatar from localStorage (already in html form)
	if (window.localStorage) {
		var myAvatar = localStorage.getItem("avatar");
		if (!myAvatar || myAvatar.length == 0) {
			return '';
		} else {
			return myAvatar;
		}
	} else {
		return 'Anonymous*';
	}

	return false;
} // getAvatar()

// == end avatar.js


// == begin post.js
function makeRefLink() {
	if (document.getElementById && document.referrer) {
		var retRef = document.getElementById('retRef');
		if (retRef) {
			retRef.innerHTML = '<a href=\"' + document.referrer + '\"' + String.fromCharCode(62) + 'Return to Previous Page</a' + String.fromCharCode(62) + ' ';
//			window.open(document.referrer + '?', '_self');
		}
	}
}
// == end post.js


// == begin fresh.js
var freshClient;
//
//function ReplacePageWithNewContent () {
//	window.location.replace(window.newPageLocation);
//	document.open();
//	document.write(window.newPageContent);
//	document.close();
//
//	return 0;
//}
//
//function StoreNewPageContent () {
//	var xmlhttp = window.xmlhttp2;
//
//	if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
//		//alert('DEBUG: PingUrlCallbackReplaceCurrentPage() found status 200');
//		window.newPageContent = xmlhttp.responseText;
//		window.newPageLocation = xmlhttp.responseURL;
//
//		//window.location.replace(xmlhttp.responseURL);
////		document.open();
////		document.write(xmlhttp.responseText);
////		document.close();
//	}
//}
//
//function FetchNewPageContent (url) {
//	if (window.XMLHttpRequest) {
//		//alert('DEBUG: PingUrl: window.XMLHttpRequest was true');
//
//		var xmlhttp;
//		if (window.xmlhttp2) {
//			xmlhttp = window.xmlhttp2;
//		} else {
//			window.xmlhttp2 = new XMLHttpRequest();
//			xmlhttp = window.xmlhttp2;
//		}
//        xmlhttp.onreadystatechange = window.StoreNewPageContent;
//        xmlhttp.open("GET", url, true);
//		  xmlhttp.setRequestHeader('Cache-Control', 'no-cache');
//        xmlhttp.send();
//
//        return false;
//	}
//}

function GetLatestPostTime () {
	var latestActionTime = 0;
	return latestActionTime;
}

function freshCallback() { // callback for requesting HEAD for current page
//alert('DEBUG: freshCallback() this.readyState = ' + this.readyState);
//#todo update codestyle/improve smell

//	if (1 || this.readyState == this.HEADERS_RECEIVED) { // headers received -- what we've been waiting for
	if (
		document.getElementById &&
		this.readyState == this.HEADERS_RECEIVED ||
		this.status == 200
	) { // headers received -- what we've been waiting for
		// document.title = 'DEBUG: callback received 200';
		//alert('DEBUG: freshCallback() this.readyState == this.HEADERS_RECEIVED');

		var eTag = freshClient.getResponseHeader("ETag"); // etag header contains page 'fingerprint'

		if (!eTag) {
			if (window.myOwnETag) {
				//alert('DEBUG: fresh.js: warning: eTag is FALSE; setting to equal myOwnETag');
				eTag = window.myOwnETag;
			} else {
				//alert('DEBUG: fresh.js: warning: eTag is FALSE; and myOwnETag is also FALSE');
			}
		}

		//alert('DEBUG: fresh.js: eTag = ' + eTag);

		if (eTag) { // if ETag header has a value
			if (window.myOwnETag) {
				//alert('DEBUG: fresh.js:  eTag = ' + eTag + '; window.myOwnETag = ' + window.myOwnETag);
				if (eTag != window.myOwnETag) {
					if (eTag == window.lastEtag) { // if it's equal to the one we saved last time
						// no new change change
					} else {
						var freshUserWantsReload = 0;  // templated
						//freshUserWantsReload = GetPrefs('fresh_reload');

						if (freshUserWantsReload) {
							// user wants reload
							//alert('DEBUG: user wants automatic page reload');
							location.reload();
						} else {
							// user doesn't want reload, just show notification
							//alert('DEBUG: user does not want automatic page reload, notify');
							window.lastEtag = eTag;

							var ariaAlert;
							ariaAlert = document.getElementById('ariaAlert');

							if (!ariaAlert) {
								//alert('DEBUG: ariaAlert created successfully');
								ariaAlert = document.createElement('p');
								ariaAlert.setAttribute('role', 'alert');
								ariaAlert.setAttribute('id', 'ariaAlert');
								ariaAlert.style.zIndex = '1337'; //#todo

								var txtUpdated = document.createTextNode('Page updated ');
								ariaAlert.appendChild(txtUpdated);

								//document.body.appendChild(ariaAlert);
								document.body.insertBefore(ariaAlert, document.body.firstChild);
								//window.newPageContent =
								//FetchNewPageContent(window.mypath + '?' + new Date().getTime());

								//ariaAlert.innerHTML = ariaAlert.innerHTML + '+';
								var d = new Date();
								var n = d.getTime();
								n = Math.ceil(n / 1000);

								var space = document.createElement('span');
								space.innerHTML = ' ';
								ariaAlert.appendChild(space);

								var a = document.createElement('a');
								a.setAttribute('id', 'freshAria');
								a.setAttribute('href', '#');
								a.setAttribute('onclick', 'location.reload()');
								ariaAlert.appendChild(a);

								var newTs = document.createElement('span');
								newTs.setAttribute('class', 'timestamp');
								newTs.setAttribute('epoch', n);
								newTs.setAttribute('id', 'freshTimestamp');
								newTs.innerHTML = 'just now!';
								a.appendChild(newTs);
							} // !ariaAlert

							if (window.freshTimeoutId) {
								clearTimeout(window.freshTimeoutId);
							}
							//window.eventLoopFresh = 0; // stop checking for updates

							if (document.title.substring(0, 2) != '! ') {
								document.title = '! ' + document.title;
							}
						} // NOT freshUserWantsReload
					} // lastEtag also didn't match
				} // eTag != window.myOwnETag
				else {
					//document.title = 'freshCallback: x ' + window.myOwnETag + ';' + new Date().getTime();
					if (window.freshTimeoutId) {
						clearTimeout(window.freshTimeoutId);
					}
					window.freshTimeoutId = setTimeout('CheckIfFresh()', 15000);
				}
			} // if (window.myOwnETag)
			else {
				window.myOwnETag = eTag;
			}
		} // if (eTag) // ETag header has value
	} // status == 200
	if (this.status == 404 && document.getElementById) {
		//alert('DEBUG: page has gone away on server (404)');
		var ariaAlert;
		ariaAlert = document.getElementById('ariaAlert');
		if (!ariaAlert) {
			ariaAlert = document.createElement('p');
			ariaAlert.setAttribute('role', 'alert');
			ariaAlert.setAttribute('id', 'ariaAlert');
			ariaAlert.style.zIndex = '1337'; //#todo
			ariaAlert.innerHTML = 'Check page existence';
			// page has gone away on server. what does it mean to exist?

			//document.body.appendChild(ariaAlert);
			document.body.insertBefore(ariaAlert, document.body.firstChild);
		}
		// window.eventLoopFresh = 0; // stop checking for updates
	} // status == 404

	return true;
} //freshCallback()

function CheckIfFresh () {
	var d = new Date();
	//alert('DEBUG: CheckIfFresh: ' + d.getTime());

	var freshCheckRecent = window.freshCheckRecent;
	if (freshCheckRecent) {
		//alert('DEBUG: CheckIfFresh: freshCheckRecent = ' + freshCheckRecent);
		var d = new Date();
		var curTime = d.getTime();
		if (curTime < freshCheckRecent + 3000) {
			return true;
		}
	}
	//alert('DEBUG: CheckIfFresh: checkpoint passed');

	var d = new Date();
	window.freshCheckRecent = d.getTime();

	var xhr = null;
	if (window.XMLHttpRequest){
		xhr = new XMLHttpRequest();
	}
	else {
		if (window.ActiveXObject) {
			xhr = new ActiveXObject("Microsoft.XMLHTTP");
		}
	}

	if (xhr) {
		var mypath = window.mypath;

		if (!mypath) {
			mypath = window.location;
			window.mypath = mypath;
		}


		freshClient = xhr;

		if (0 && mypath.toString().indexOf('?') == -1) {
			// NO question mark (or params)
			// cachebuster
			// this ensures no caching, but may cause other problems
			// q: what problems?
			freshClient.open("HEAD", mypath + '?' + d.getTime(), true);
		} else {
			// below we strip the page arguments if they begin with ?message=

			if (mypath.toString().indexOf('?message=') == -1) {
				// leave it
				freshClient.open("HEAD", mypath, true);
			} else {
				// remove the parameters
				mypath = mypath.toString().substr(0, mypath.toString().indexOf('?message='));
				freshClient.open("HEAD", mypath, true);
			}
		}

		//freshClient.timeout = 5000; //#xhr.timeout
		freshClient.setRequestHeader('Cache-Control', 'no-cache');
		freshClient.onreadystatechange = freshCallback;

		freshClient.send();
	}

	return true;
} // CheckIfFresh()
//
//if (window.GetPrefs) {
//	var needNotify = (GetPrefs('notify_on_change') ? 1 : 0);
//	if (needNotify == 1) { // check value of notify_on_change preference
//		if (window.EventLoop) {
//			EventLoop();
//		} else {
//			CheckIfFresh();
//		}
//	}
//}

//alert('DEBUG: fresh.js');


if (window.EventLoop) {
	if (!window.GetPrefs) {
		// if no prefs, enable it
		window.eventLoopEnabled = 1;
		window.eventLoopFresh = 1;
	}
	
	EventLoop();
} else {
	CheckIfFresh();
}

// == end fresh.js


/* table_sort.js */

function SortTable (t, sortOrder) {
// TableSort (
	//alert('DEBUG: SortTable() begins');
	//caution: bubble sort inside

	if (! document.body.textContent) {
		//alert('DEBUG: SortTable: warning: textContent feature check FAILED');
		return '';
	}

	var table, rows, switching, i, x, y, shouldSwitch, sortColumn, sortMethod;

	sortColumn = 0;
	sortMethod = 0;

	// sortMethod = 0 innerHTML
	// sortMethod = 1 textContent
	// sortMethod = 2 parseInt(innerHTML)

	if (1 < sortOrder) {
		return '';
	}

	var rowColor0 = '#202020';
	var rowColor1 = '#282828';

	sortOrder = sortOrder ? 1 : 0;

	var anyChanges = 0;

	var tOrig = t;

	if (!t) {
		//alert('DEBUG: SortTable: warning: t missing');
		return '';
	}

	var sortField = t.textContent;

	if (t.cellIndex || t.cellIndex == 0) {
		sortColumn = t.cellIndex;
		// default sortMethod is 0, defined above
		// innerHTML

		if (
			t.textContent &&
			t.textContent.indexOf('_title') != -1 ||
			t.textContent.indexOf('author_key') != -1 ||
			t.textContent.indexOf('author_id') != -1
		) {
			sortMethod = 1; // textContent
		}

		if (
			t.textContent &&
			(
				t.textContent.indexOf('_count') != -1 ||
				t.textContent.indexOf('_order') != -1 ||
				t.textContent.indexOf('_sequence') != -1 ||
				t.textContent.indexOf('_score') != -1
			)
		) {
			sortMethod = 2; // parseInt(innerHTML)
		}

		if (
			t.textContent &&
			(
				t.textContent.indexOf('_timestamp') != -1
			)
		) {
			sortMethod = 3; // timestamp widget
		}
	}

	while (!table && t.parentNode) {
		t = t.parentNode;
		if (t.tagName == 'TABLE') {
			table = t;
		}
	}

	if (!table) {
		//alert('DEBUG: SortTable: warning: table missing');
		return '';
	} else {
		//alert('DEBUG: SortTable: table exists, proceeding');
	}

	if (table && table.getAttribute) {
		var tableId = table.getAttribute('id');
		if (tableId) {
			if (window.SetPrefs) {
				SetPrefs('TableSort:' + tableId, sortField + ':' + sortOrder + ':' + sortMethod);
			}
		}
	} else {
		//alert('DEBUG: SortTable: warning: table is missing');
		return '';
	}

	//alert('DEBUG: SortTable: sortOrder = ' + sortOrder + '; sortMethod = ' + sortMethod);

	// bubble sort below by some website...

	switching = true;

	/* Make a loop that will continue until
	no switching has been done: */
	while (switching) {
		// Start by saying: no switching is done:
		switching = false;
		rows = table.rows;

		/* Loop through all table rows (except the
		first, which contains table headers): */
		for (i = 1; i < (rows.length - 2); i++) {
			// Start by saying there should be no switching:
			shouldSwitch = false;
			/* Get the two elements you want to compare,
			one from current row and one from the next: */

			x = rows[i].getElementsByTagName("TD")[sortColumn];
			y = rows[i + 1].getElementsByTagName("TD")[sortColumn];
			// Check if the two rows should switch place:

			if (
				x &&
				y &&
				x.innerHTML &&
				y.innerHTML
			) {
				var xValue = 0;
				var yValue = 0;

				if (sortMethod == 0) {
					xValue = x.innerHTML;
					yValue = y.innerHTML;
				}
				if (sortMethod == 1) {
					xValue = x.textContent; // #todo lowercase
					yValue = y.textContent; // #todo lowercase
				}
				if (sortMethod == 2) {
					if (x.textContent == '-') {
						xValue = 0;
					} else {
						xValue = parseInt(x.innerHTML);
					}
					if (y.textContent == '-') {
						yValue = 0;
					} else {
						yValue = parseInt(y.innerHTML);
					}
				}
				if (sortMethod == 3) {
					var xWidget = x.getElementsByClassName('timestamp');
					xValue = xWidget[0].getAttribute('datetime');
					var yWidget = y.getElementsByClassName('timestamp');
					yValue = yWidget[0].getAttribute('datetime');
				}

				//////

				if (
					(
						sortOrder == 0
						&&
						xValue < yValue
					)
					||
					(
						sortOrder == 1
						&&
						yValue < xValue
					)
				) {
					// If so, mark as a switch and break the loop:
					shouldSwitch = true;
					anyChanges++;
					break;
				}
			}
		}
		if (shouldSwitch) {
			/* If a switch has been marked, make the switch
			and mark that a switch has been done: */
			rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
			switching = true;
		}
	} // while (switching)

	if (!anyChanges) {
		sortOrder++
		return SortTable(tOrig, sortOrder);
	}

	if (anyChanges) {
		rows = table.rows;
		var rowsLength = rows.length;

		for (i = 2; i < rowsLength - 1; i++) {
			if (
				rows[i] &&
				rows[i].style.backgroundColor == rowColor0 ||
				rows[i].style.backgroundColor == rowColor1 ||
				rows[i].getAttribute('bgcolor') == rowColor0 ||
				rows[i].getAttribute('bgcolor') == rowColor1
			) {
				// the above check avoids changing the color of highlighted rows
				if (i % 2) {
					rows[i].style.backgroundColor = rowColor0;
				} else {
					rows[i].style.backgroundColor = rowColor1;
				}
			}
		}
	}

	//alert('DEBUG: SortTable() finished');

	return '';
} // SortTable()

/* / table_sort.js */

// -->
</script>
<!-- / html/utils/scriptinject.template -->
</body></html>